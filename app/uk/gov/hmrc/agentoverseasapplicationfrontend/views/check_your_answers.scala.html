@*
* Copyright 2018 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@
@import play.api.Configuration
@import play.mvc.Call
@import uk.gov.hmrc.agentoverseasapplicationfrontend.controllers.routes
@import uk.gov.hmrc.agentoverseasapplicationfrontend.models._
@import uk.gov.hmrc.agentoverseasapplicationfrontend.models.Yes
@import uk.gov.hmrc.agentoverseasapplicationfrontend.forms._
@import scala.collection.immutable.SortedSet
@import uk.gov.hmrc.play.views.html.helpers.form
@import uk.gov.hmrc.agentoverseasapplicationfrontend.views.html.helpers.check_answers_div

@(agentSession: AgentSession, countryName: String)(implicit request: Request[_], messages: Messages, configuration: Configuration)

@uk.gov.hmrc.agentoverseasapplicationfrontend.views.html.main_template(title = Messages("checkAnswers.title"), bodyClasses = None) {

    <a href="@routes.ApplicationController.showYourTaxRegNumbersForm" class="link-back">@Messages("button.back")</a>

    <h1 class="heading-xlarge margin-bottom-30">@Messages("checkAnswers.title")</h1>

    @agentSession.amlsDetails.map { details =>

        <h2 class="heading-medium margin-bottom-10">@Messages("checkAnswers.amlsDetails.title")</h2>

        <dl class="app-check-your-answers app-check-your-answers--long">
            <div class="app-check-your-answers__contents">
                <dt class="app-check-your-answers__question">
                    @Messages("checkAnswers.amlsDetails.supervisoryBody") <br>
                @Messages("checkAnswers.amlsDetails.memebershipNumber")
                </dt>
                <dd class="app-check-your-answers__answer" id="amls-details">
                    @details.supervisoryBody<br>
                    @details.membershipNumber
                </dd>
                <dd class="app-check-your-answers__change">
                    <a href="@routes.ChangingAnswersController.changeAmlsDetails()">@Messages("checkAnswers.change.button") <span class="visuallyhidden"> @Messages("checkAnswers.change.button")</span></a>
                </dd>
            </div>
        </dl>
    }

    @agentSession.contactDetails.map { details =>

        <h2 class="heading-medium margin-bottom-10">@Messages("checkAnswers.contactDetails.title")</h2>

        <dl class="app-check-your-answers app-check-your-answers--long">
            @check_answers_div(
            Html(
                List(Messages("checkAnswers.contactDetails.name"),
                     Messages("checkAnswers.contactDetails.jobTitle"),
                     Messages("checkAnswers.contactDetails.businessTelephone"),
                     Messages("checkAnswers.contactDetails.businessEmail")).mkString("<br>")
            ),
            Html(
                List(details.firstName + " " +details.lastName,
                     details.jobTitle,
                     details.businessTelephone,
                     details.businessEmail).mkString("<br>")
            ),
            routes.ChangingAnswersController.changeContactDetails())
        </dl>
    }

    <h2 class="heading-medium margin-bottom-10">@Messages("checkAnswers.BusinessDetails.title")</h2>

    @agentSession.tradingName.map { name =>
        <dl class="app-check-your-answers app-check-your-answers--long">
           @check_answers_div(Messages("checkAnswers.tradingName.title"),  name, routes.ChangingAnswersController.changeTradingName())
        </dl>
    }

    @agentSession.mainBusinessAddress.map { address =>
        <dl class="app-check-your-answers app-check-your-answers--long">
            @check_answers_div(
            Messages("checkAnswers.mainBusinessAddress.title"),
            Html(List(address.addressLine1,address.addressLine2, address.addressLine3.getOrElse(""), address.addressLine4.getOrElse(""), countryName).filter(_.nonEmpty).mkString("<br>")),
            routes.ChangingAnswersController.changeTradingAddress()
            )
        </dl>
    }

    <h2 class="heading-medium margin-bottom-10">@Messages("checkAnswers.OtherBusinessDetails.title")</h2>

    @agentSession.registeredWithHmrc.map { isRegistered =>

        <dl class="app-check-your-answers app-check-your-answers--long">
            @check_answers_div(Messages("checkAnswers.registeredWithHmrc.title"),  isRegistered, routes.ChangingAnswersController.changeRegisteredWithHmrc())

            @if(isRegistered == Yes) {
                @agentSession.agentCodes.flatMap(_.selfAssessment).map { sa =>
                    @check_answers_div(Messages("checkAnswers.agentCode.selfAssessment"),  sa, routes.ChangingAnswersController.changeAgentCodes())
                }

                @agentSession.agentCodes.flatMap(_.corporationTax).map { ct =>
                    @check_answers_div(Messages("checkAnswers.agentCode.corporationTax"),  ct, routes.ChangingAnswersController.changeAgentCodes())
                }

                @agentSession.agentCodes.flatMap(_.vat).map { vat =>
                    @check_answers_div(Messages("checkAnswers.agentCode.vat"),  vat, routes.ChangingAnswersController.changeAgentCodes())
                }

                @agentSession.agentCodes.flatMap(_.paye).map { paye =>
                     @check_answers_div(Messages("checkAnswers.agentCode.paye"),  paye, routes.ChangingAnswersController.changeAgentCodes())
                }
            }
        </dl>
    }

    @agentSession.registeredForUkTax.map { isRegisteredForUKTax =>
        <dl class="app-check-your-answers app-check-your-answers--long">
            @check_answers_div(Messages("checkAnswers.registeredForUKTax.title"),  isRegisteredForUKTax, routes.ChangingAnswersController.changeRegisteredForUKTax())

            @if(isRegisteredForUKTax == Yes) {

                @agentSession.personalDetails.flatMap(_.nino).map { nino =>
                    @check_answers_div(Messages("checkAnswers.personalDetails.nino.title"),  nino, routes.ChangingAnswersController.changePersonalDetails())
                }

                @agentSession.personalDetails.flatMap(_.saUtr).map { saUtr =>
                    @check_answers_div(Messages("checkAnswers.personalDetails.saUtr.title"),  saUtr, routes.ChangingAnswersController.changePersonalDetails())
                }
            }
        </dl>
    }

    @agentSession.companyRegistrationNumber.flatMap(_.registrationNumber).map { crn =>
        <dl class="app-check-your-answers app-check-your-answers--long">
            @check_answers_div(Messages("checkAnswers.companyRegistrationNumber.title"),  crn, routes.ChangingAnswersController.changeCompanyRegistrationNumber())
        </dl>
    }

    @agentSession.hasTaxRegNumbers.map { hasTrn =>

        @if(hasTrn == true) {
            <dl class="app-check-your-answers app-check-your-answers--long">
                @check_answers_div(
                        Messages("checkAnswers.taxRegistrationNumbers.title"),
                        Html(agentSession.taxRegistrationNumbers.getOrElse(SortedSet.empty[String]).mkString("<br>")),
                        routes.ChangingAnswersController.changeYourTaxRegistrationNumbers()
                )
            </dl>
        }
    }

    @form(
        action = routes.ApplicationController.submitCheckYourAnswers(),
        'class -> "form js-form") {

        <div class="form-group">
            <button class="button margin-top-30" type="submit" id="continue" >@Messages("checkAnswers.confirm.button")</button>
        </div>
    }
}
